"use strict";var plangular=angular.module("plangular",[]),clientID="0d33361983f16d2527b01fbf6408b7d7",iconUrl="icons/plangular-icons.svg";plangular.directive("plangular",function(d,a,e){var c=d[0].createElement("audio");var b={track:false,playing:false,paused:false,tracks:null,i:null,play:function(f,g){if(g==null){f=new Array(f);g=0}b.tracks=f;b.track=f[g];b.i=g;if(b.paused!=b.track){c.src=b.track.stream_url+"?client_id="+clientID}c.play();b.playing=b.track;b.paused=false},pause:function(){c.pause();if(b.playing){b.paused=b.playing;b.playing=false}},playPlaylist:function(f){if(b.tracks==f.tracks&&b.paused){b.play(b.tracks,b.i)}else{b.play(f.tracks,0)}},next:function(f){if(!f){if(b.i+1<b.tracks.length){b.i++;b.play(b.tracks,b.i)}else{b.pause()}}else{if(f&&f.tracks==b.tracks){if(b.i+1<b.tracks.length){b.i++;b.play(f.tracks,b.i)}else{b.pause()}}}},previous:function(f){if(f.tracks==b.tracks&&b.i>0){b.i=b.i-1;b.play(f.tracks,b.i)}}};c.addEventListener("ended",function(){a.$apply(function(){if(b.tracks.length>0){b.next()}else{b.pause()}})},false);return{restrict:"A",scope:true,link:function(g,h,f){var i={url:f.src,client_id:clientID,callback:"JSON_CALLBACK"};e.jsonp("//api.soundcloud.com/resolve.json",{params:i}).success(function(j){if(j.tracks){g.playlist=j}else{if(j.kind=="track"){g.track=j}else{g.data=j}}});g.player=b;g.audio=c;g.currentTime=0;g.duration=0;c.addEventListener("timeupdate",function(){if(g.track==b.track||(g.playlist&&g.playlist.tracks==b.tracks)){g.$apply(function(){g.currentTime=(c.currentTime*1000).toFixed();g.duration=(c.duration*1000).toFixed()})}},false);g.seekTo=function(k){var j=k.offsetX/k.target.offsetWidth;c.currentTime=(j*c.duration)}}}});plangular.directive("plangularIcon",function(){var a=null,b;a=new XMLHttpRequest();a.open("GET",iconUrl,false);a.send(null);if(a.responseXML){b=a.responseXML.documentElement}else{console.error("Icon sprite not found - check iconUrl variable in plangular.js")}return{restrict:"A",scope:true,link:function(f,g,d){if(!b){return false}var e=g[0],h=d.plangularIcon,c=b.getElementById(h).cloneNode(true);e.className+=" plangular-icon plangular-icon-"+h;c.removeAttribute("id");c.setAttribute("class",e.className);e.parentNode.replaceChild(c,e)}}});plangular.filter("playTime",function(){return function(b){var a=Math.floor(b/3600000),d="0"+Math.floor((b%3600000)/60000),c="0"+Math.floor((b%60000)/1000);d=d.substr(d.length-2);c=c.substr(c.length-2);if(!isNaN(c)){if(a){return a+":"+d+":"+c}else{return d+":"+c}}else{return"00:00"}}});